function adminDialog(){function init(){$("body").append('<div id="mainAdminDialog"></div>');$("div#mainAdminDialog").dialog({modal:!0,title:"Notes - Administration",close:function(event,ui){$("div#mainAdminDialog").remove()},position:{my:"center",at:"center",of:$("div.main")},resizable:!1,width:$("div.main").width(),height:500});setContent('Loading ...')}
init();function setContent(html){$("div#mainAdminDialog").html(html)}
function mainView(){var salt;ajax_request('admin',{userid:userinformation.id,art:'list'},function(data){if(data.status==="okay"){salt=data.data.salt;var html="<h3>Userliste</h3>"+"<table> <tr><th>UserId</th><th>Username</th><th>Admin</th><th>Löschen</th> </tr>";data.data.list.forEach(function(value){html+='<tr userid="'+value.userid+'" class="'+(value.userid==userinformation.id?'important':'')+'">'+"<td>"+value.userid.substr(0,20)+"</td>"+"<td>"+value.username+"</td>"+'<td><code style="color:black;">'+value.admin+"</code></td>"+'<td><button class="delUser">Löschen</button></td>'+"</tr>"});html+="</table>";html+="<h3>Hinzufügen</h3>"+'<input type="text" id="newUserName" placeholder="Username"><br />'+'Admin: <input type="radio" id="newUserAdmin" name="newUserAdmin" value="true"> true '+'<input type="radio" id="newUserAdmin" name="newUserAdmin" value="false" checked="checked"> false <br />'+'<input type="password" id="newUserPasswordA" placeholder="Passwort"><br />'+'<input type="password" id="newUserPasswordB" placeholder="Passwort"><br />'+'<button id="newUserButton">Erstellen</button>'
setContent(html);$("button#newUserButton").click(function(){if($("input#newUserPasswordA").val()==""||$("input#newUserName").val()==""){alert('Sie müssen alle Felder füllen!');return}
var username=$("input#newUserName").val();var match=/[^a-z]+/;if(match.test(username)){alert('Der Usernamen darf nur aus Kleinbuchstaben bestehen!');return}
if($("input#newUserPasswordA").val()!=$("input#newUserPasswordB").val()){alert('Die Passwörter stimmen nicht überein!');return}
var password=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash($("input#newUserPasswordA").val()));password=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(password+"+"+salt));var userdata={name:$("input#newUserName").val(),admin:($("input#newUserAdmin:checked").val()=='true'?!0:!1),password:password,salt:salt};ajax_request('admin',{userid:userinformation.id,art:'add',user:userdata},function(data){if(data.data.done==!0){mainView()}
if(typeof data.error[0]==="string"&&data.error[0]==="Username already assigned!"){alert("Username bereits vergeben!")}})});$("button.delUser").click(function(){var userId=$(this).parent().parent().attr('userid');if(confirm("Wollen Sie den User mit der ID: '"+userId+"' wirklich löschen?")){if(userId==userinformation.id){if(!confirm("Sie löschen Ihren eigenen Account!! (Achten Sie darauf, dass immer ein Administrator bestehen bleibt!)")){return}}
ajax_request('admin',{userid:userinformation.id,art:'del',deluserid:userId},function(data){if(data.data.done==!0){mainView()}})}})}
else{setContent("Fehler!")}})}
mainView()}