function adminDialog(){function e(e){$("div#mainAdminDialog").html(e)}$("body").append('<div id="mainAdminDialog"></div>'),$("div#mainAdminDialog").dialog({modal:!0,title:"Notes - Administration",close:function(e,n){$("div#mainAdminDialog").remove()},position:{my:"center",at:"center",of:$("div.main")},resizable:!1,width:$("div.main").width(),height:500}),e("Loading ..."),function n(){var i;ajax_request("admin",{userid:userinformation.id,art:"list"},function(t){if("okay"===t.status){i=t.data.salt;var r="<h3>Userliste</h3><table> <tr><th>UserId</th><th>Username</th><th>Admin</th><th>Löschen</th> </tr>";t.data.list.forEach(function(e){r+='<tr userid="'+e.userid+'" class="'+(e.userid==userinformation.id?"important":"")+'"><td>'+e.userid.substr(0,20)+"</td><td>"+e.username+'</td><td><code style="color:black;">'+e.admin+'</code></td><td><button class="delUser">Löschen</button></td></tr>'}),r+="</table>",e(r+='<h3>Hinzufügen</h3><input type="text" id="newUserName" placeholder="Username"><br />Admin: <input type="radio" id="newUserAdmin" name="newUserAdmin" value="true"> true <input type="radio" id="newUserAdmin" name="newUserAdmin" value="false" checked="checked"> false <br /><input type="password" id="newUserPasswordA" placeholder="Passwort"><br /><input type="password" id="newUserPasswordB" placeholder="Passwort"><br /><button id="newUserButton">Erstellen</button>'),$("button#newUserButton").click(function(){if(""!=$("input#newUserPasswordA").val()&&""!=$("input#newUserName").val()){var e=$("input#newUserName").val();if(/[^a-z]+/.test(e))alert("Der Usernamen darf nur aus Kleinbuchstaben bestehen!");else if($("input#newUserPasswordA").val()==$("input#newUserPasswordB").val()){var t=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash($("input#newUserPasswordA").val()));t=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(t+"+"+i));var r={name:$("input#newUserName").val(),admin:"true"==$("input#newUserAdmin:checked").val(),password:t,salt:i};ajax_request("admin",{userid:userinformation.id,art:"add",user:r},function(e){1==e.data.done&&n(),"string"==typeof e.error[0]&&"Username already assigned!"===e.error[0]&&alert("Username bereits vergeben!")})}else alert("Die Passwörter stimmen nicht überein!")}else alert("Sie müssen alle Felder füllen!")}),$("button.delUser").click(function(){var e=$(this).parent().parent().attr("userid");if(confirm("Wollen Sie den User mit der ID: '"+e+"' wirklich löschen?")){if(e==userinformation.id&&!confirm("Sie löschen Ihren eigenen Account!! (Achten Sie darauf, dass immer ein Administrator bestehen bleibt!)"))return;ajax_request("admin",{userid:userinformation.id,art:"del",deluserid:e},function(e){1==e.data.done&&n()})}})}else e("Fehler!")})}()}